
## **Core Architecture:**

### 1. **Multi-Source Bootstrap Strategy**
**Three Bootstrap Methods:**
- **Embedded Seeds**: Hardcoded in binary (6 geographically diverse nodes)
- **DNS Seeds**: TXT records for dynamic peer discovery
- **Kademlia DHT**: Distributed hash table for decentralized discovery

**Bootstrap Sequence:**
1. Connect to embedded seeds (wait for ≥2 connections)
2. Query DNS seeds for additional peers
3. Bootstrap DHT from connected peers
4. Discover peers via DHT random walk
5. Peer exchange with connected peers

### 2. **Peer Discovery Mechanisms**

**DNS Seed Protocol:**
```
_ecliptica-mainnet._tcp.seed.ecliptica.network. TXT 
  "p2p://12D3KooWAbc...@1.2.3.4:26656"
```

**Kademlia DHT:**
- K-bucket size: 20 peers
- Replication factor: 20
- Query timeout: 30 seconds
- Record TTL: 36 hours

**Peer Exchange (PEX):**
- Request up to 50 peers
- Filter by node type/shard
- Sort by reputation
- Return top N diverse peers

### 3. **Network Partition Handling**

**Detection Metrics:**
- Connected peers vs target (weight: 0.3)
- Blocks received vs expected (weight: 0.4)
- Beacon connectivity (weight: 0.3)
- **Partition score >0.5 = partitioned**

**Recovery Strategies:**
1. Re-bootstrap from seeds
2. Aggressive DHT peer discovery
3. Peer exchange with all connections
4. Diversify connections (geography, AS)
5. Wait for recovery (60s timeout)

### 4. **Eclipse Attack Prevention**

**Multi-Path Diversity:**
- IP prefix diversity (/24 blocks)
- ASN diversity (Autonomous Systems)
- Geographic diversity (countries/regions)
- Connection type diversity (inbound/outbound/DHT/PEX)

**Diversity-Based Peer Selection:**
- Score = 70% diversity + 30% reputation
- Prefer peers from new IP prefixes
- Prefer peers from new ASNs
- Prefer peers from new countries

**Anchor Connections:**
- Maintain ≥3 connections to trusted foundation nodes
- Geographic diversity (US-East, EU-West, Asia-East)
- Never disconnect from anchors
- Reconnect immediately if lost

### 5. **Sybil Resistance**

**Stake-Weighted Peer Scoring:**
```
Score = 0.4 × reputation 
      + 0.4 × log(stake) 
      + 0.2 × diversity_bonus
```

**Connection Limits:**
- Max validators: 50
- Max full nodes: 30
- Max light clients: 20
- Max per IP: 3
- Max per ASN: 10
- Max total: 100

**Stake Proof for Network Access:**
- Validators prove stake via zk-STARK
- Freshness requirement (within 1 hour)
- ML-DSA signature over stake amount
- Higher stake = higher connection priority

### 6. **Reputation System**

**Reputation Scoring:**
- Uptime score (30% weight)
- Latency score (20% weight)
- Behavior score (50% weight)

**Trust Levels:**
- Trusted: Score >0.75, no malicious behavior, known >1 hour
- Banned: >3 malicious acts OR score <0.2

**Malicious Behavior:**
- Invalid blocks/transactions
- Excessive failed responses
- Protocol violations
- Ban duration: 24 hours

### 7. **GossipSub Topics**

**Global Topics:**
- `/ecliptica/blocks/1.0.0` - Block propagation
- `/ecliptica/txs/1.0.0` - Transaction propagation
- `/ecliptica/consensus/1.0.0` - Consensus messages
- `/ecliptica/beacon/1.0.0` - Beacon chain

**Per-Shard Topics:**
- `/ecliptica/shard-0/1.0.0` through `/ecliptica/shard-7/1.0.0`

**Message Validation:**
- Size limit enforcement
- Rate limiting per peer
- Format validation
- Accept/Reject/Ignore decisions

### 8. **Transport & Security**

**Supported Transports:**
- **TCP + Noise + Yamux** (fallback)
- **QUIC** (preferred, built-in encryption)

**Hybrid Key Exchange:**
- Classical: ECDH P-256
- Post-Quantum: ML-KEM-512
- Combined with SHAKE-256
- Session key derivation via HKDF

**Authentication:**
- ML-DSA (Dilithium-3) signatures
- Mutual authentication
- Signed handshake messages

### 9. **Network Monitoring**

**Key Metrics:**
- Connected peers, discovered peers, banned peers
- ASN diversity, country diversity, diversity score
- Bandwidth usage (sent/received)
- Latency (average, p99)
- Message counts (sent/received/dropped)
- Partition score, eclipse risk score

**Alerting Thresholds:**
- Critical: <10 peers, partition score >0.5, eclipse risk >0.7
- Warning: Diversity score <0.3

## **Key Innovations:**

1. **Post-Quantum P2P**: First blockchain with ML-DSA authenticated connections
2. **Stake-Weighted Sybil Resistance**: Logarithmic stake scoring prevents whale dominance
3. **Multi-Dimensional Diversity**: IP + ASN + Geography + Connection Type
4. **Anchor Network**: Trusted foundation nodes prevent eclipse attacks
5. **Adaptive Peer Selection**: Dynamic scoring based on reputation + diversity + stake
6. **Cross-Shard Connectivity Monitoring**: Ensure sufficient connections to each shard

## **Performance Targets:**

- **Peer connections**: 50-100 per node
- **Block propagation**: <200ms (p99)
- **Transaction propagation**: <500ms (p99)
- **Bootstrap time**: <30 seconds
- **Partition recovery**: <60 seconds

## **Summary:**

Ecliptica's network layer provides **enterprise-grade resilience** against:
- Eclipse attacks (multi-path diversity + anchors)
- Sybil attacks (stake-weighted scoring + connection limits)
- Network partitions (multi-source bootstrap + monitoring)
- Reputation-based filtering (ban malicious actors)

This ensures the network remains **decentralized, secure, and performant** even under adversarial conditions.

