
## **Key Sections:**

### **1. Contract State Visibility Rules (Section 2)**
- **Three-tier model**: Private, Permissioned, Public
- **Encrypted storage architecture** with deterministic key derivation
- **AES-256-GCM encryption** for all contract state
- **Sparse Merkle Tree** commitments for state verification

### **2. Privacy-Preserving Contract Calls (Section 3)**
- **ML-KEM-512 encrypted parameters** and return values
- **zk-STARK proofs** of state transitions
- **Re-entrancy protection** with call stack tracking (max depth: 10)
- What's hidden: parameters, returns, intermediate state
- What's revealed: caller address, target address, method name, gas used

### **3. Event Logging with Privacy (Section 4)**
- **Three privacy levels**: Private, Selective, Public
- **Encrypted events** with ML-KEM for authorized viewers
- **Event commitments** for verification without decryption
- **Event filtering** with viewing keys for decryption
- Example: Transfer events with selective field encryption

### **4. Contract-to-Contract Interaction (Section 5)**
- **Three interaction patterns**: Synchronous calls, Callbacks, Event-driven
- **Interface-based composition** for privacy-preserving composability
- **Encrypted state queries** across contracts
- Examples: DEX swaps, Oracle callbacks

### **5. Gas Metering for Encrypted Operations (Section 6)**
- **Fixed-cost encryption**: Independent of plaintext content
- **Deterministic gas schedule**: Prevents information leakage
- **Size-based storage costs**: Padded to block size
- Complete gas cost schedule:
  - Storage read: 5,000
  - Storage write: 20,000
  - ML-KEM encrypt/decrypt: 10,000 each
  - ML-DSA sign/verify: 15,000 / 8,000
  - Contract call base: 50,000
  - zk-STARK generate/verify: 100,000 / 10,000

### **6. Complete Working Examples (Section 7)**

**Private Token Contract**:
- Fully encrypted balances
- Balance commitments (public)
- Private transfers with encrypted events
- Viewing keys for balance queries

**Private Voting Contract**:
- Encrypted vote tallies
- Vote commitments (prevent double-voting)
- Zero-knowledge vote proofs
- Admin-only result decryption after voting period

### **7. Security Considerations (Section 8)**
- **Threat model** with mitigations for:
  - State leakage via gas timing
  - Re-entrancy attacks
  - Storage exhaustion
  - Viewing key compromise
  - Event correlation
- **Best practices** for developers

### **8. Future Enhancements (Section 9)**
- **Fully Homomorphic Encryption (FHE)**: Computation on encrypted data
- **Multi-Party Computation (MPC)**: Joint computation without revealing inputs
- **Zero-Knowledge Virtual Machine**: Entire execution proven in ZK

## **Key Technical Innovations:**

1. **Deterministic storage key derivation** using SHAKE-256
2. **Contract-specific encryption keys** preventing cross-contract leakage
3. **Encrypted message passing** with ML-KEM-512 for inter-contract calls
4. **Fixed-cost gas metering** independent of encrypted content
5. **Three-tier event privacy** with selective field encryption
6. **Viewing key hierarchy** for granular access control

## **Privacy Guarantees:**

✓ **State privacy**: All storage encrypted, only commitments public  
✓ **Execution privacy**: Validators see proofs, not plaintext  
✓ **Call privacy**: Parameters and returns encrypted end-to-end  
✓ **Event privacy**: Encrypted logs with authorized viewer access  
✓ **Gas privacy**: Fixed costs prevent timing-based leakage  

This fills the **Contract Privacy Model** design gap completely with:
- ✅ Contract state visibility rules with formal model
- ✅ Privacy-preserving contract calls with encrypted messaging
- ✅ Event logging with privacy (three-tier model)
- ✅ Contract-to-contract interaction patterns
- ✅ Gas metering for encrypted operations (deterministic, fixed-cost)

